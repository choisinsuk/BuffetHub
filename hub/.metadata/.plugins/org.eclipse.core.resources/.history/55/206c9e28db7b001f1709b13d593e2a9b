package com.hub.service;

import java.time.LocalDateTime;
import java.time.ZoneId;
import java.util.Date;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.security.crypto.password.PasswordEncoder;

import com.hub.domain.User;
import com.hub.dto.ReserveDTO;
import com.hub.repository.UserRepository;

import lombok.extern.log4j.Log4j2;

@SpringBootTest
@Log4j2
public class ReserveServiceTests {

	@Autowired
	private ReserveService reserveService;
	
	@Autowired
	private UserRepository userRepository;
	
	@Autowired
	private PasswordEncoder passwordEncoder;
	
	@Test
	public void testRegister() {
		
		// 예약시간 설정(예: 2024년 9월 27일 18시 30분)
	    LocalDateTime reserveDateTime = LocalDateTime.of(2024, 9, 27, 18, 30);
	    Date reserveTime = Date.from(reserveDateTime.atZone(ZoneId.systemDefault()).toInstant());

		// 예시로 사용할 User와 Voucher생성
		User user = User.builder().ur_id("testUser").ur_pw(passwordEncoder.encode("password1")).ur_nm("홍길동") // 이름
				.ur_phn("01012345678") // 전화번호
				.ur_eml("test@example.com") // 이메일
				.ur_prpl_yn("1") // 개인정보 이용약관 동의 여부
				.ur_stmbpl_yn("1") // 가게 회원 약관 동의 여부
				.ur_join_dt(new Date()) // 회원가입 일자
				.ur_condition_code("ACTIVE").ur_auth_code("testmem")// 회원 상태
				.build();
		
		// User 저장
		userRepository.save(user);
		
		
		ReserveDTO reserveDTO = ReserveDTO.builder()
				.rs_dt()
				.ur_id(user.getUr_id())
				.bv_nb(61).build();
		
		Long rs_nb = reserveService.register(reserveDTO);
		log.info("rs_nb: " + rs_nb);
	}
}
